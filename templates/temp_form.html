<!doctype html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
  <link href='https://fonts.googleapis.com/css?family=Inter:400,500,600,700' rel='stylesheet'>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <script src="//ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.9.0/p5.min.js" integrity="sha256-WVsM3xrcqyuFNF3W1qtIKbHFsD0977nDQA8DCMp1zCw=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.9.0/addons/p5.dom.min.js" integrity="sha256-2/3R3NV5zryj0fDjD3cDh+SNiWQ/TJiMVZzAo5FrhiU=" crossorigin="anonymous"></script>
  <title>DataSnap</title>
  <link rel="shortcut icon" href="{{url_for('static',filename='favicon.png')}}" type="image/x-icon">
</head>

<style>
  /* Modern design system with clean color palette */
  :root {
    --primary: #6366f1;
    --primary-dark: #4f46e5;
    --accent: #ec4899;
    --success: #10b981;
    --background: #f8fafc;
    --surface: #ffffff;
    --border: #e2e8f0;
    --text-primary: #1e293b;
    --text-secondary: #64748b;
  }

  html {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  }

  body {
    background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
    color: var(--text-primary);
    min-height: 100vh;
    padding: 2rem 1rem;
  }

  /* Modern heading with better typography */
  h2 {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    font-size: 2rem;
    font-weight: 700;
    margin-bottom: 2rem;
    color: var(--text-primary);
  }

  /* Modern button styling with smooth transitions */
  .btn {
    border-radius: 8px;
    font-weight: 600;
    font-size: 0.95rem;
    padding: 0.75rem 1.5rem;
    border: none;
    transition: all 0.3s ease;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .btn-info {
    background-color: var(--primary);
    color: white;
  }

  .btn-info:hover {
    background-color: var(--primary-dark);
    transform: translateY(-2px);
    box-shadow: 0 8px 16px rgba(99, 102, 241, 0.3);
  }

  .btn-secondary {
    background-color: var(--text-secondary);
    color: white;
  }

  .btn-secondary:hover {
    background-color: var(--text-primary);
  }

  .btn-primary {
    background-color: var(--success);
    color: white;
  }

  .btn-primary:hover {
    background-color: #059669;
  }

  /* Remove old neumorphic styling, use modern flat design */
  .contri {
    border-radius: 8px;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
  }

  .contri_btn {
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(99, 102, 241, 0.15);
  }

  /* Modern input styling */
  .form-control,
  .form-select {
    border-radius: 8px;
    border: 1.5px solid var(--border);
    padding: 0.875rem 1rem;
    font-size: 0.95rem;
    transition: all 0.3s ease;
    background-color: var(--surface);
    color: var(--text-primary);
  }

  .form-control:focus,
  .form-select:focus {
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
  }

  /* Modern input group styling */
  .input-group-text {
    background-color: var(--surface);
    border: 1.5px solid var(--border);
    border-radius: 8px;
    color: var(--text-primary);
    font-weight: 600;
    padding: 0.875rem 1rem;
  }

  .input-group-select {
    display: flex;
    align-items: center;
    padding: 0.875rem 1rem;
    font-size: 0.95rem;
    font-weight: 600;
    color: var(--text-primary);
    background-color: var(--surface);
    border: 1.5px solid var(--border);
    border-radius: 8px;
    transition: all 0.3s ease;
  }

  /* Modern input group layout */
  .input-group {
    gap: 0.75rem;
    margin-bottom: 1.5rem;
  }

  .input-group > .form-control {
    flex: 1;
  }

  /* Modern icon styling */
  .fa-times-circle,
  .fa-plus-circle {
    color: var(--primary);
    transition: all 0.3s ease;
    cursor: pointer;
    font-size: 1.5rem !important;
  }

  .fa-times-circle:hover {
    color: var(--accent);
    transform: scale(1.1);
  }

  .fa-plus-circle:hover {
    color: var(--success);
    transform: scale(1.1);
  }

  /* Modern modal styling */
  .modal-content {
    border-radius: 12px;
    border: 1.5px solid var(--border);
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
  }

  .modal-header {
    background-color: var(--background);
    border-bottom: 1.5px solid var(--border);
    border-radius: 12px 12px 0 0;
    padding: 1.5rem;
  }

  .modal-title {
    font-weight: 700;
    color: var(--text-primary);
    font-size: 1.25rem;
  }

  .modal-body {
    padding: 1.5rem;
  }

  .modal-footer {
    border-top: 1.5px solid var(--border);
    padding: 1.5rem;
    background-color: var(--background);
  }

  /* Modern badge styling */
  .badge {
    padding: 0.5rem 0.875rem;
    font-size: 0.875rem;
    font-weight: 600;
    border-radius: 6px;
  }

  .badge.bg-primary {
    background-color: var(--primary) !important;
    color: white;
  }

  .bg-info {
    background-color: var(--primary) !important;
  }

  /* Modern table styling */
  .table {
    border-collapse: separate;
    border-spacing: 0;
  }

  .table-bordered {
    border: 1.5px solid var(--border);
    border-radius: 8px;
    overflow: hidden;
  }

  .table-bordered thead {
    background-color: var(--background);
  }

  .table-bordered th {
    border-color: var(--border);
    color: var(--text-primary);
    font-weight: 700;
    padding: 1rem;
  }

  .table-bordered td {
    border-color: var(--border);
    padding: 1rem;
    color: var(--text-secondary);
  }

  /* Modern form check styling */
  .form-check-input {
    width: 1.25rem;
    height: 1.25rem;
    border: 2px solid var(--border);
    border-radius: 4px;
    transition: all 0.3s ease;
  }

  .form-check-input:checked {
    background-color: var(--primary);
    border-color: var(--primary);
  }

  .form-check-input:focus {
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
  }

  .form-check-label {
    font-weight: 500;
    color: var(--text-primary);
    margin-left: 0.5rem;
  }

  /* Modern container spacing */
  .container {
    max-width: 800px;
  }

  .row {
    gap: 1rem;
  }

  /* Responsive spacing */
  @media (max-width: 768px) {
    h2 {
      font-size: 1.5rem;
    }

    .btn {
      padding: 0.65rem 1.25rem;
      font-size: 0.85rem;
    }

    .input-group {
      flex-direction: column;
    }

    .form-control,
    .form-select,
    .input-group-text {
      width: 100%;
    }
  }
</style>

<body>
  {% macro catch(on_exception) %}
  {{ handle_catch(caller, on_exception) }}
  {% endmacro %}
  <div>
    <h2 class="text-center"><img src="{{url_for('static',filename='favicon.png')}}" alt="" height="50" style="margin-right: 1rem;"> {{form_data['form_title']}} <img src="{{url_for('static',filename='favicon.png')}}" alt="" height="50" style="margin-left: 1rem;"></h2>
    
    <!-- Button trigger modal -->
    <div class="row my-4">
      <div class="col">
        <button type="button" class="btn btn-info mx-2 contri_btn" data-bs-toggle="modal" data-bs-target="#Add_Field_Modal">
          <i class="fa fa-plus mx-1"></i> CREATE NEW FIELD
        </button>
      
        <a type="button" class="btn btn-info mx-2 contri_btn" href="/">
          <i class="fa fa-arrow-left mx-1"></i> BACK
        </a>

        <button type="button" class="btn btn-info mx-2 contri_btn" style="float:right" onclick="Save()">
          SAVE <i class="fa fa-cloud-download mx-2"></i>
        </button>
       
        <button type="button" class="btn btn-info mx-2 contri_btn" style="float:right" data-bs-toggle="modal" data-bs-target="#Properties_Modal">
          <i class="fa fa-sliders-h mx-1"></i> PROPS
        </button>
        
        <button type="button" class="btn btn-info mx-2 contri_btn" style="float:right" data-bs-toggle="modal" data-bs-target="#Details_Modal">
          <i class="fa fa-info-circle mx-1"></i> DETAILS
        </button>
      </div>


      <div class="offcanvas offcanvas-start" tabindex="-1" id="Responses_Modal" aria-labelledby="offcanvasExampleLabel" style="width:100%">
        <div class="offcanvas-header">
          <h4 class="offcanvas-title" id="offcanvasExampleLabel">Responses</h4>
          <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
        </div>
        <div class="offcanvas-body">
          <div>
            {% call catch('') %}
            {% for key,val in form_data['responses'].items()%}
            <table class="table table-bordered border-info">
              <thead>
                <tr>
                  {% for _key,_val in val.items()%}
                  <th scope="col">{{_val["key"]}}</th>
                  {% endfor %}
                  
                </tr>
              </thead>
              <tbody>
                <tr>
                  {% for _key,_val in val.items()%}
                  <th >{{_val["resp"]}}</th>
                  {% endfor %}
                
               
                </tr>
                
                
              </tbody>
            </table>
            {% endfor %}
            {% endcall %}
          </div>

          <!-- <div class="dropdown mt-3">
            <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-bs-toggle="dropdown">
              Dropdown button
            </button>
            <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton">
              <li><a class="dropdown-item" href="#">Action</a></li>
              <li><a class="dropdown-item" href="#">Another action</a></li>
              <li><a class="dropdown-item" href="#">Something else here</a></li>
            </ul>
          </div> -->
        </div>
      </div>


      <div class="modal fade" id="Settings_Modal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLabel">Form Settings</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <div class="form-check form-switch">
                {% if form_data['accepting_response']== 0 %}
                <input class="form-check-input" type="checkbox" role="switch" id="form_accepting_response" >
                {% else %}
                <input class="form-check-input" type="checkbox" role="switch" id="form_accepting_response" checked >
                {% endif %}
                <label class="form-check-label" for="flexSwitchCheckChecked">Accepting Responses</label>
  

              </div>
              <!-- <div class="form-check form-switch">
                {% if form_data['admin_notify_new_responses']== 0 %}
                <input class="form-check-input" type="checkbox" role="switch" id="form_admin_notify_new_responses" >
                {% else %}
                <input class="form-check-input" type="checkbox" role="switch" id="form_admin_notify_new_responses" checked >
                {% endif %}
                <label class="form-check-label" for="">Notify me for new responses</label>
  

              </div> -->
            </div>
            <div class="modal-footer">
              <!-- <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
              <button type="button" class="btn btn-info">Save changes</button> -->
            </div>
          </div>
        </div>
      </div>


      <div class="modal fade" id="Properties_Modal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLabel">Field Properties</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            
            <div class="modal-body">
              <div class="row" id="Properties_Fields">
                {% call catch('') %}
                {% for key,val in form_data['data'].items()%}
                {% if val!="timestamp" %}
                {% if val['required'] == "true" %}
                <div class="col-auto">
                  <input type="text" class="form-control" value="{{val['text']}}" disabled>
                </div>
                <div class="col-auto">
                  
                  <div class="form-check form-switch my-2">
                    <input class="form-check-input required_checkboxes_fields" type="checkbox" role="switch" id="Required_{{key}}" checked>
                    <label class="form-check-label" for="flexSwitchCheckChecked">Required</label>
                  </div>
                </div>
                {% else %}
                <div class="col-auto">
                  <input type="text" class="form-control" value="{{val['text']}}" disabled>
                </div>
                <div class="col-auto">
                  
                  <div class="form-check form-switch my-2">
                    <input class="form-check-input required_checkboxes_fields" type="checkbox" role="switch" id="Required_{{key}}" >
                    <label class="form-check-label" for="flexSwitchCheckChecked">Required</label>
                  </div>
                </div>
                {% endif %}
                {% endif %}
                {% endfor %}
                {% endcall %}
               
              </div>
            </div>
            <div class="modal-footer">
              <p style="color:#ec4899; font-size: 0.875rem;"><i class="fa fa-info-circle mx-1"></i>Refresh if field appears empty</p>
            </div>
          </div>
        </div>
      </div>



      <div class="modal fade" id="Add_Field_Modal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLabel">Add New Field</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <div class="form-check">
                <input class="form-check-input" type="radio" name="flexRadioDefault" id="text_field" checked>
                <label class="form-check-label" for="flexRadioDefault1">
                  Text Field
                </label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="radio" name="flexRadioDefault" id="email_field" >
                <label class="form-check-label" for="flexRadioDefault1">
                  Email Field
                </label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="radio" name="flexRadioDefault" id="select_field" >
                <label class="form-check-label" for="flexRadioDefault2">
                  Select Field
                </label>
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
              <button type="button" class="btn btn-primary" onclick="Add_Field()">Add Field</button>
            </div>
          </div>
        </div>
      </div>






  <div class="modal fade" id="Details_Modal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Form Details</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="mb-3" id="Details_Modal_Body">
          <label for="exampleFormControlInput1" class="form-label">Public URL</label>
          <button class="btn btn-sm btn-info contri_btn my-1" style="float:right" onclick="Copy_Clip()"><i class="fa fa-copy mx-1"></i>Copy Link</button>
          <!-- {% if not form_data['short-url']%}
          <button class="btn-sm btn-info contri_btn fnt m-1" id="short-url-button" style="float:right" onclick="Shorten_Url()">Shorten Url</button>
          {% endif %} -->
          <input type="text" class="form-control" id="public_url_form"  disabled>
          {% if form_data['short-url']%}
          <!-- <label for="exampleFormControlInput1" class="form-label">Shortened URL</label> -->
          <input type="text" class="form-control" id="shortened_public_url_form" value="{{form_data['short-url']}}" disabled>
          {% endif %}
  

        </div>
    
      <div class="row my-5">
        <div class="col">
          <div class="row">

            <button type="button" class="btn btn-info contri_btn my-2" data-bs-toggle="modal" data-bs-target="#Settings_Modal" data-bs-dismiss="modal">
              <i class="fa fa-cog mx-1"></i> SETTINGS
             </button>
          </div>
          <div class="row">

            <button type="button" class="btn btn-info contri_btn px-4 my-2"  data-bs-toggle="offcanvas" data-bs-target="#Responses_Modal" data-bs-dismiss="modal">
             <i class="fa fa-comments mx-1"></i> RESPONSES
            </button>
          </div>
        </div>
      </div>
        
      </div>
      <div class="modal-footer">
        <!-- <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        <button type="button" class="btn btn-info">Save changes</button> -->
      </div>
    </div>
  </div>
</div>

    </div>
  <div class="container" id="main_form">
    {% call catch('') %}
    {% for key,val in form_data['data'].items()%}
    {% if val != "timestamp" %}
    {% if val['type'] == 'text' or val['type'] == 'email'%}
    <div class="input-group my-2" id="{{key}}">
      {% if val['type'] == 'email' %}
        <input class="input-group-text mx-2" value="{{val['text']}}" disabled>
        {% else %}
        <input class="input-group-text mx-2" value="{{val['text']}}">
        {% endif %}
        <input type="text"  class="form-control" disabled>
        <i class="fa fa-times-circle mx-1" style="cursor:pointer" onclick = "Remove_Field('{{key}}')"></i>


      </div>
      {% else %}





      <div class="input-group my-2" id="{{key}}">
        <input class="input-group-text mx-2" value="{{val['text']}}">
        <select name="" id="{{key}}_select" class="form-control">
            <option value="Options" default> Option List</option>
          {% for key_opt,opt in val['options'].items()%}
          <option value="{{key_opt}}">{{opt}}</option>
          {% endfor %}
        </select>
        <i class="fa fa-plus-circle mx-1" style="cursor:pointer" data-bs-toggle="modal" data-bs-target="#{{key}}_Options_Modal"></i>
        <i class="fa fa-times-circle mx-1" style="cursor:pointer" onclick = "Remove_Field('{{key}}')"></i>

      </div>



      <div class="modal fade" id="{{key}}_Options_Modal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLabel">Manage Options</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <div class="mb-3">
                <label for="exampleFormControlInput1" class="form-label">Add New Option</label>
                <input type="text" class="form-control" id="{{key}}_option_add" placeholder="Write option">
              </div>
              <div class="row">
                <div class="col" id="{{key}}_all_options">
                  {% for key_opt,opt in val['options'].items()%}
                  <span class="badge rounded-pill bg-primary my-1" id="{{key_opt}}" >{{opt}}<i class="fa fa-times-circle  mx-1" style="cursor:pointer" onclick = "Remove_Option('{{key}}','{{key_opt}}')"></i></span>
                  {% endfor %}

      
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
              <button type="button" class="btn btn-primary"  onclick = "Add_Option('{{key}}')">Add Option</button>
            </div>
          </div>
        </div>
      </div>









      {% endif %}
      {% endif %}
      {% endfor %}
      {% endcall %}




    



    </div>


  </div>
    </div>

    <!-- Modal -->

  
    <script>
   function Copy_Clip() {
      var copyText = document.getElementById("public_url_form");
      copyText.select();
      copyText.setSelectionRange(0, 99999);

      navigator.permissions.query({ name: 'clipboard-write' }).then((result) => {
        if (result.state === 'granted' || result.state === 'prompt') {
          navigator.clipboard.writeText(copyText.value).then(() => {
            alert("Link Copied!!");
          }).catch((error) => {
            console.error('Failed to copy text: ', error);
          });
        }
      }).catch((error) => {
        console.error('Failed to query clipboard permissions: ', error);
      });
    }
   
      var main_json = "{{form_data['data']}}"
      var all_json_unparsed = decodeHtml(main_json.slice(1,main_json.length-1))
       all_json_unparsed = "{"+all_json_unparsed+"}"
       all_json_parsed = JSON.parse(all_json_unparsed.replaceAll("'", '"'))

      var data
       = all_json_parsed

      all_input_group_text = document.getElementsByClassName("input-group-text")
        if(all_input_group_text.length!=0){
          for(let i=0;i<all_input_group_text.length;i++){
            let temp_elem =all_input_group_text[i]
            temp_elem.addEventListener("input",function(){
             
               let parent_id  = temp_elem.parentElement.id
               data[parent_id]['text'] = temp_elem.value
             
               temp_elem.setAttribute("value",temp_elem.value)
            })
          }
        }

    
     


      function Add_Field() {
      if(document.getElementById("text_field").checked){

        let uid_field =makeid(7)
      let container = document.getElementById("main_form")
      let Properties_Fields = document.getElementById("Properties_Fields")
      container.innerHTML+=` <div class="input-group my-2" id="${uid_field}">
        <input class="input-group-text mx-2">
          <input type="text"  class="form-control" disabled>
          <i class="fa fa-times-circle mx-1" style="cursor:pointer" onclick = "Remove_Field('${uid_field}')"></i>
  
      </div> `
        Properties_Fields.innerHTML+=`<div class="col-auto" id="div_props_${uid_field}">
          <input type="text" class="form-control" id="props_${uid_field}" value="" disabled>
        </div>
        <div class="col-auto">
          
          <div class="form-check form-switch my-2" id="div_input_props_${uid_field}">
            <input class="form-check-input required_checkboxes_fields" type="checkbox" role="switch" id="Required_${uid_field}">
            <label class="form-check-label" for="flexSwitchCheckChecked">Required</label>
          </div>
        </div>`
        data[uid_field] = {

        }
        data[uid_field]['type'] = "text"

        all_input_group_text = document.getElementsByClassName("input-group-text")
        if(all_input_group_text.length!=0){
          for(let i=0;i<all_input_group_text.length;i++){
            let temp_elem =all_input_group_text[i]
            temp_elem.addEventListener("input",function(){
               let parent_id  = temp_elem.parentElement.id
               data[parent_id]['text'] = temp_elem.value
               document.getElementById("props_"+parent_id).value = temp_elem.value
             
               temp_elem.setAttribute("value",temp_elem.value)
            })
          }
        }
         
      }

      else if(document.getElementById("email_field").checked){

        let uid_field =makeid(7)
      let container = document.getElementById("main_form")
      let Properties_Fields = document.getElementById("Properties_Fields")
      container.innerHTML+=` <div class="input-group my-2" id="${uid_field}">
        <input class="input-group-text mx-2" value="Email" disabled>
          <input type="email"  class="form-control" disabled>
          <i class="fa fa-times-circle mx-1" style="cursor:pointer" onclick = "Remove_Field('${uid_field}')"></i>
  
      </div> `
        Properties_Fields.innerHTML+=`<div class="col-auto" id="div_props_${uid_field}">
          <input type="text" class="form-control" id="props_${uid_field}" value="" disabled>
        </div>
        <div class="col-auto">
          
          <div class="form-check form-switch my-2" id="div_input_props_${uid_field}">
            <input class="form-check-input required_checkboxes_fields" type="checkbox" role="switch" id="Required_${uid_field}">
            <label class="form-check-label" for="flexSwitchCheckChecked">Required</label>
          </div>
        </div>`
        data[uid_field] = {

        }
        data[uid_field]['type'] = "email"
        data[uid_field]['text'] = "Email"

        all_input_group_text = document.getElementsByClassName("input-group-text")
        if(all_input_group_text.length!=0){
          for(let i=0;i<all_input_group_text.length;i++){
            let temp_elem =all_input_group_text[i]
            temp_elem.addEventListener("input",function(){
          
               let parent_id  = temp_elem.parentElement.id
               data[parent_id]['text'] = temp_elem.value
             
               temp_elem.setAttribute("value",temp_elem.value)
            })
          }
        }
         
      }

        else{
        

          let uid_field =makeid(7)
          let container = document.getElementById("main_form")
          let Properties_Fields = document.getElementById("Properties_Fields")
          container.innerHTML+=`    <div class="input-group my-2" id="${uid_field}">
            <input class="input-group-select mx-2" >
            <select name="" id="${uid_field}_select" class="form-control">
             <option value="Options" default> Option List</option>
            </select>
            <i class="fa fa-plus-circle mx-1" style="cursor:pointer" data-bs-toggle="modal" data-bs-target="#Options_Modal_${uid_field}"></i>
            <i class="fa fa-times-circle mx-1" style="cursor:pointer" onclick = "Remove_Field('${uid_field}')"></i>
    
          </div>
          
          
          <div class="modal fade" id="Options_Modal_${uid_field}" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="exampleModalLabel">Manage Options</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                  <div class="mb-3">
                    <label for="exampleFormControlInput1" class="form-label">Add New Option</label>
                    <input type="text" class="form-control" id="${uid_field}_option_add" placeholder="Write option">
                  </div>
                  <div class="row">
                    <div class="col" id="${uid_field}_all_options">
                      
                    </div>
                  </div>
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                  <button type="button" class="btn btn-primary"  onclick = "Add_Option('${uid_field}')">Add Option</button>
                </div>
              </div>
            </div>
          </div>`
    Properties_Fields.innerHTML+=`<div class="col-auto" id="div_props_${uid_field}">
      <input type="text" class="form-control" id="props_${uid_field}" value="" disabled>
    </div>
    <div class="col-auto">
      
      <div class="form-check form-switch my-2" id="div_input_props_${uid_field}">
        <input class="form-check-input required_checkboxes_fields" type="checkbox" role="switch" id="Required_${uid_field}">
        <label class="form-check-label" for="flexSwitchCheckChecked">Required</label>
      </div>
    </div>`

    data[uid_field] = {

    }
    data[uid_field]['type'] = "select"
    data[uid_field]['options'] = {

    }

    all_input_group_select = document.getElementsByClassName("input-group-select")
    if(all_input_group_select.length!=0){
      for(let i=0;i<all_input_group_select.length;i++){
        let temp_elem =all_input_group_select[i]
        temp_elem.addEventListener("input",function(){
         
           let parent_id  = temp_elem.parentElement.id
           data[parent_id]['text'] = temp_elem.value
         
           temp_elem.setAttribute("value",temp_elem.value)
        })
      }
    }
    all_input_group_text = document.getElementsByClassName("input-group-text")
        if(all_input_group_text.length!=0){
          for(let i=0;i<all_input_group_text.length;i++){
            let temp_elem =all_input_group_text[i]
            temp_elem.addEventListener("input",function(){
          
               let parent_id  = temp_elem.parentElement.id
               data[parent_id]['text'] = temp_elem.value
             
               temp_elem.setAttribute("value",temp_elem.value)
            })
          }
        }

        }



      }
      function Remove_Field(id){
            document.getElementById(id).remove()
            // document.getElementById("div_props_"+id).remove()
            // document.getElementById("div_input_props_"+id).remove()
            delete data[id]
      }
   
      function Save(){
        let param = JSON.stringify(data)
        $.ajax({
          url: "{{form_data['callback_url']}}",
          type:'POST',
          data:{
            "main":param
          },
        }).done(function(data) {
            // alert("Form Saved")
            window.location.reload()
        }).fail(function(XMLHttpRequest, textStatus, errorThrown) {
            console.log(XMLHttpRequest);
            alert("error");
        })
      }
      function decodeHtml(html) {
        var txt = document.createElement("textarea");
        txt.innerHTML = html;
        return txt.value;
    }
      function makeid(length) {
        var result           = '';
        var characters       = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
        var charactersLength = characters.length;
        for ( var i = 0; i < length; i++ ) {
          result += characters.charAt(Math.floor(Math.random() * 
     charactersLength));
       }
       return result;
    }

    document.getElementById("public_url_form").value = window.location.origin+"{{form_data['public_url']}}"
    document.getElementById("public_url_form").setAttribute("value", window.location.origin+"{{form_data['public_url']}}")
    document.getElementById("form_accepting_response").addEventListener('change',function(e){
        if(this.checked){
          $.ajax({
            url: "{{form_data['callback_url']}}"+"/change-resp-code",
            type:'POST',
            data:{
              'resp_code':1,
              'name':0
            }
          }).done(function(data) {
             
          }).fail(function(XMLHttpRequest, textStatus, errorThrown) {
              console.log(XMLHttpRequest);
              alert("error");
          })
        }
        else{
          $.ajax({
            url: "{{form_data['callback_url']}}"+"/change-resp-code",
            type:'POST',
            data:{
              'resp_code':0,
              'name':0
            }
          }).done(function(data) {
       
          }).fail(function(XMLHttpRequest, textStatus, errorThrown) {
              console.log(XMLHttpRequest);
              alert("error");
          })
        }
    })

    // document.getElementById("form_admin_notify_new_responses").addEventListener('change',function(e){
    //     if(this.checked){
    //       $.ajax({
    //         url: "{{form_data['callback_url']}}"+"/change-resp-code",
    //         type:'POST',
    //         data:{
    //           'resp_code':1,
    //           'name':1
    //         }
    //       }).done(function(data) {
             
    //       }).fail(function(XMLHttpRequest, textStatus, errorThrown) {
    //           console.log(XMLHttpRequest);
    //           alert("error");
    //       })
    //     }
    //     else{
    //       $.ajax({
    //         url: "{{form_data['callback_url']}}"+"/change-resp-code",
    //         type:'POST',
    //         data:{
    //           'resp_code':0,
    //           'name':1
    //         }
    //       }).done(function(data) {
       
    //       }).fail(function(XMLHttpRequest, textStatus, errorThrown) {
    //           console.log(XMLHttpRequest);
    //           alert("error");
    //       })
    //     }
    // })

   console.log("___MBSA____")
   all_required_checkboxes = document.getElementsByClassName("required_checkboxes_fields")
   for(let i =0;i<all_required_checkboxes.length;i++){
    all_required_checkboxes[i].addEventListener('change',function(e){
      if(this.checked){
           let temp_id = this.id.split('_')[1]
           data[temp_id]['required'] = "true"
      }
      else{
        let temp_id = this.id.split('_')[1]
        data[temp_id]['required'] = "false"
      }
    })
   }
  


    function Add_Option(id){
      let opt_id = makeid(7)
      let text = document.getElementById(id+"_option_add").value
      document.getElementById(id+"_all_options").innerHTML += `
      <span class="badge rounded-pill bg-primary my-1" id="${opt_id}">${text} <i class="fa fa-times-circle  mx-1" style="cursor:pointer" onclick = "Remove_Option('${id}','${opt_id}')"></i></span>
      `
      document.getElementById(id+"_option_add").value = ""
      let x = document.getElementById(id+"_select");
      let option = document.createElement("option");
      option.text = text
      option.value = opt_id
      x.add(option);

      data[id]['options'][opt_id] = text

     
    }
    function Remove_Option(id,opt_id){
      document.getElementById(opt_id).remove()
      let x = document.getElementById(id+"_select");
      for(let i=0;i<x.length;i++){
        if(x[i].value == opt_id){
          x.remove(i)
          delete data[id]['options'][opt_id]
        }
      }

    }
    function Shorten_Url(){
      public_url_form = document.getElementById("public_url_form").value
      $.ajax({
        url: "{{form_data['callback_url']}}"+"/shorten-url",
        type:'POST',
        data:{
          'public_url_form':public_url_form
        }
       
      }).done(function(data) {
        document.getElementById("Details_Modal_Body").innerHTML+=`<label for="exampleFormControlInput1" class="form-label">Shortened URL</label>
        <input type="text" class="form-control" id="shortened_public_url_form" value="${data}"  disabled>`
        document.getElementById("short-url-button").remove()
   
      }).fail(function(XMLHttpRequest, textStatus, errorThrown) {
          console.log(XMLHttpRequest);
          alert("Can't reach servers! Try Again Later!!!");
      })
    }
    </script>
  </div>



  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
    crossorigin="anonymous"></script>



</body>

</html>
